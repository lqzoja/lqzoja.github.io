

<!-- post | photo -->
<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="UTF-8">

<title>BZOJ 2002: [Hnoi2010]Bounce 弹飞绵羊 | SW_Wind&#39;s blog</title>

<script src="/js/jquery-2.0.3.min.js"></script>
<link rel="stylesheet" type="text/css" href="/css/style.css">
<!-- Mathjax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});
</script>
<script type="text/javascript" async
  src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML">
</script>
<!-- Valine -->
<script src="https://cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src="/js/Valine.min.js"></script>
  </head>
  <body>
    <header>
      <div style="background-image: url(/img/author.jpg)" class="author_img"></div>
<div class="blog-title">
	<p class="title">SW_Wind&#39;s blog</p>
	<p class="subtitle">你指尖跃动的电光，是我此生不变的信仰</p>
</div>
<ul class="headerlinks">

  <li><a href="/">首页</a></li>

  <li><a href="/about">关于</a></li>

  <li><a href="/archives">档案</a></li>

  <li><a href="/tags">标签云</a></li>

</ul>
    </header>
    <div class="container">
      <div class="main">
        <div class="post">
  <article>
    <div class="artc-title">
      <h1>BZOJ 2002: [Hnoi2010]Bounce 弹飞绵羊</h1>
      <p><span class="time-icon">2017-04-10</span><span class="author-icon">SW_Wind</span></p>
    </div>
    <div class="artc">
      
        <div class="toc-father">
          <strong class="toc-title">文章目录</strong>
          
            <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#题面"><span class="toc-number">1.</span> <span class="toc-text">题面</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Input"><span class="toc-number">2.</span> <span class="toc-text">Input</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Output"><span class="toc-number">3.</span> <span class="toc-text">Output</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Sample-Input"><span class="toc-number">4.</span> <span class="toc-text">Sample Input</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Sample-Output"><span class="toc-number">5.</span> <span class="toc-text">Sample Output</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#题解"><span class="toc-number">6.</span> <span class="toc-text">题解</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#代码"><span class="toc-number">7.</span> <span class="toc-text">代码</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#LCT做法-4-14-Update"><span class="toc-number">8.</span> <span class="toc-text">LCT做法 (4.14 Update)</span></a></li></ol>
          
        </div>
      
      <h1 id="题面"><a href="#题面" class="headerlink" title="题面"></a>题面</h1><p>某天，Lostmonkey发明了一种超级弹力装置，为了在他的绵羊朋友面前显摆，他邀请小绵羊一起玩个游戏。游戏一开始，Lostmonkey在地上沿着一条直线摆上$n$个装置，每个装置设定初始弹力系数$k_i$，当绵羊达到第$i$个装置时，它会往后弹$k_i$步，达到第$i+k_i$个装置，若不存在第$i+k_i$个装置，则绵羊被弹飞。绵羊想知道当它从第$i$个装置起步时，被弹几次后会被弹飞。为了使得游戏更有趣，Lostmonkey可以修改某个弹力装置的弹力系数，任何时候弹力系数均为正整数。</p>
<h1 id="Input"><a href="#Input" class="headerlink" title="Input"></a>Input</h1><p>第一行包含一个整数$n$，表示地上有$n$个装置，装置的编号从$0$到$n-1$,接下来一行有$n$个正整数，依次为那$n$个装置的初始弹力系数。第三行有一个正整数$m$，接下来$m$行每行至少有两个数$i$、$j$，若$i=1$，你要输出从$j$出发被弹几次后被弹飞，若$i=2$则还会再输入一个正整数$k$，表示第$j$个弹力装置的系数被修改成$k$。<br>对于$20\%$的数据$n,m\leq 10000$。<br>对于$100\%$的数据$n\leq 200000,m\leq 100000$。<br><a id="more"></a></p>
<h1 id="Output"><a href="#Output" class="headerlink" title="Output"></a>Output</h1><p>对于每个$i=1$的情况，你都要输出一个需要的步数，占一行。</p>
<h1 id="Sample-Input"><a href="#Sample-Input" class="headerlink" title="Sample Input"></a>Sample Input</h1><p>4<br>1 2 1 1<br>3<br>1 1<br>2 1 1<br>1 1</p>
<h1 id="Sample-Output"><a href="#Sample-Output" class="headerlink" title="Sample Output"></a>Sample Output</h1><p>2<br>3</p>
<h1 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h1><p>这题有两种做法。。但我只会分块。。LCT太恶心了，看了一个晚上就是看不懂他在干什么。。没事rever个毛线啊（听说是为了保证复杂度。。）<br>分块的话，直接一个块一个块跳。。具体我就不说了（<del>别问我怎么这么像hzwer的</del></p>
<h1 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h1><figure class="highlight cpp"><table><tr><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> N 200020</span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">read</span><span class="params">()</span></span>&#123;</div><div class="line">	<span class="keyword">int</span> x=<span class="number">0</span>,f=<span class="number">1</span>;<span class="keyword">char</span> ch=getchar();</div><div class="line">	<span class="keyword">while</span>(ch&gt;<span class="string">'9'</span>||ch&lt;<span class="string">'0'</span>)&#123;<span class="keyword">if</span>(ch==<span class="string">'-'</span>)f=<span class="number">-1</span>;ch=getchar();&#125;</div><div class="line">	<span class="keyword">while</span>(ch&lt;=<span class="string">'9'</span>&amp;&amp;ch&gt;=<span class="string">'0'</span>)&#123;x=x*<span class="number">10</span>+ch-<span class="string">'0'</span>;ch=getchar();&#125;</div><div class="line">	<span class="keyword">return</span> x*f;</div><div class="line">&#125;</div><div class="line"><span class="keyword">int</span> n, st[N], pt[N], a[N], l[<span class="number">1020</span>], pos[N];</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">	<span class="keyword">int</span> block = <span class="built_in">sqrt</span>(n = read());</div><div class="line">	<span class="keyword">int</span> cnt = n/block;</div><div class="line">	<span class="keyword">if</span>(n%block) cnt++;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)&#123;</div><div class="line">		a[i] = read();</div><div class="line">		pos[i] = (i<span class="number">-1</span>)/block+<span class="number">1</span>;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= cnt; i++)</div><div class="line">		l[i] = (i<span class="number">-1</span>)*block+<span class="number">1</span>;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = n; i; i--)</div><div class="line">		<span class="keyword">if</span>(i+a[i]&gt;n) st[i] = <span class="number">1</span>;</div><div class="line">		<span class="keyword">else</span> <span class="keyword">if</span>(pos[i]==pos[i+a[i]])</div><div class="line">			st[i] = st[i+a[i]]+<span class="number">1</span>, pt[i] = pt[i+a[i]];</div><div class="line">		<span class="keyword">else</span> st[i] = <span class="number">1</span>, pt[i] = i+a[i];</div><div class="line">	<span class="keyword">int</span> m = read();</div><div class="line">	<span class="keyword">while</span>(m--)&#123;</div><div class="line">		<span class="keyword">int</span> op = read(), x = read()+<span class="number">1</span>, y = <span class="number">0</span>;</div><div class="line">		<span class="keyword">if</span>(op == <span class="number">1</span>)&#123;</div><div class="line">			<span class="keyword">while</span>(x)&#123;</div><div class="line">				y += st[x];</div><div class="line">				x = pt[x];</div><div class="line">			&#125;</div><div class="line">			<span class="built_in">printf</span>(<span class="string">"%d\n"</span>, y);</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">else</span>&#123;</div><div class="line">			a[x] = read();</div><div class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> i = x; i &gt;= l[pos[x]]; i--)</div><div class="line">				<span class="keyword">if</span>(pos[i]==pos[i+a[i]])</div><div class="line">					st[i] = st[i+a[i]]+<span class="number">1</span>, pt[i] = pt[i+a[i]];</div><div class="line">				<span class="keyword">else</span> st[i] = <span class="number">1</span>, pt[i] = i+a[i];</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="LCT做法-4-14-Update"><a href="#LCT做法-4-14-Update" class="headerlink" title="LCT做法 (4.14 Update)"></a>LCT做法 (4.14 Update)</h1><p>学过了才发现不过如此<br>跑的比分块慢多了<br><del>别问我怎么还是很像hzwer的</del><br><figure class="highlight cpp"><table><tr><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> N 200020</span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">read</span><span class="params">()</span></span>&#123;</div><div class="line">	<span class="keyword">int</span> x=<span class="number">0</span>,f=<span class="number">1</span>;<span class="keyword">char</span> ch=getchar();</div><div class="line">	<span class="keyword">while</span>(ch&gt;<span class="string">'9'</span>||ch&lt;<span class="string">'0'</span>)&#123;<span class="keyword">if</span>(ch==<span class="string">'-'</span>)f=<span class="number">-1</span>;ch=getchar();&#125;</div><div class="line">	<span class="keyword">while</span>(ch&lt;=<span class="string">'9'</span>&amp;&amp;ch&gt;=<span class="string">'0'</span>)&#123;x=x*<span class="number">10</span>+ch-<span class="string">'0'</span>;ch=getchar();&#125;</div><div class="line">	<span class="keyword">return</span> x*f;</div><div class="line">&#125;</div><div class="line"><span class="keyword">int</span> c[N][<span class="number">2</span>], fa[N], rev[N], st[N], sz[N], nxt[N];</div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">isroot</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</div><div class="line">	<span class="keyword">return</span> c[fa[x]][<span class="number">0</span>] != x &amp;&amp; c[fa[x]][<span class="number">1</span>] != x;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">push_down</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</div><div class="line">	<span class="keyword">if</span>(!rev[x])<span class="keyword">return</span>;</div><div class="line">	rev[x] ^= <span class="number">1</span>;</div><div class="line">	rev[c[x][<span class="number">0</span>]] ^= <span class="number">1</span>;</div><div class="line">	rev[c[x][<span class="number">1</span>]] ^= <span class="number">1</span>;</div><div class="line">	swap(c[x][<span class="number">0</span>], c[x][<span class="number">1</span>]);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">push_up</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</div><div class="line">	sz[x] = sz[c[x][<span class="number">0</span>]]+sz[c[x][<span class="number">1</span>]]+<span class="number">1</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">rotate</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</div><div class="line">	<span class="keyword">int</span> y = fa[x], z = fa[y];</div><div class="line">	<span class="keyword">int</span> r = c[y][<span class="number">0</span>] == x, l = r^<span class="number">1</span>;</div><div class="line">	<span class="keyword">if</span>(!isroot(y)) c[z][c[z][<span class="number">0</span>]!=y] = x;</div><div class="line">	fa[x] = z; fa[y] = x; fa[c[x][r]] = y;</div><div class="line">	c[y][l] = c[x][r]; c[x][r] = y;</div><div class="line">	push_up(y); push_up(x);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">splay</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</div><div class="line">	<span class="keyword">int</span> top = <span class="number">0</span>; st[++top]=x;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = x; !isroot(i); i=fa[i])</div><div class="line">		st[++top] = fa[i];</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = top; i; i--)</div><div class="line">		push_down(st[i]);</div><div class="line">	<span class="keyword">while</span>(!isroot(x))&#123;</div><div class="line">		<span class="keyword">int</span> y = fa[x], z = fa[y];</div><div class="line">		<span class="keyword">if</span>(!isroot(y))<span class="keyword">if</span>(c[y][<span class="number">0</span>]==x^c[z][<span class="number">0</span>]==y)rotate(x);</div><div class="line">		<span class="keyword">else</span> rotate(y);</div><div class="line">		rotate(x);</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">access</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</div><div class="line">	<span class="keyword">int</span> t = <span class="number">0</span>;</div><div class="line">	<span class="keyword">while</span>(x)&#123;</div><div class="line">		splay(x);</div><div class="line">		c[x][<span class="number">1</span>] = t;</div><div class="line">		t = x; x = fa[x];</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">rever</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</div><div class="line">	access(x);splay(x);</div><div class="line">	rev[x]^=<span class="number">1</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">link</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span>&#123;</div><div class="line">	rever(x);</div><div class="line">	fa[x] = y;</div><div class="line">	splay(x);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">cut</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span>&#123;</div><div class="line">	rever(x); access(y); splay(y);</div><div class="line">	c[y][<span class="number">0</span>] = fa[x] = <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">find</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</div><div class="line">	access(x); splay(x);</div><div class="line">	<span class="keyword">int</span> y = x;</div><div class="line">	<span class="keyword">while</span>(c[y][<span class="number">0</span>])y=c[y][<span class="number">0</span>];</div><div class="line">	<span class="keyword">return</span> y;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">	<span class="keyword">int</span> n = read();</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>,x; i &lt;= n; i++)&#123;</div><div class="line">		nxt[i] = (x=read())+i;</div><div class="line">		sz[i] = <span class="number">1</span>;</div><div class="line">		<span class="keyword">if</span>(nxt[i] &gt; n) nxt[i] = n+<span class="number">1</span>;</div><div class="line">		fa[i] = nxt[i];</div><div class="line">	&#125;</div><div class="line">	sz[n+<span class="number">1</span>] = <span class="number">1</span>;</div><div class="line">	<span class="keyword">int</span> m = read();</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; i++)&#123;</div><div class="line">		<span class="keyword">if</span>(read()==<span class="number">1</span>)&#123;</div><div class="line">			<span class="keyword">int</span> x = read()+<span class="number">1</span>;</div><div class="line">			rever(n+<span class="number">1</span>); access(x); splay(x);</div><div class="line">			<span class="built_in">printf</span>(<span class="string">"%d\n"</span>, sz[c[x][<span class="number">0</span>]]);</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">else</span>&#123;</div><div class="line">			<span class="keyword">int</span> x = read()+<span class="number">1</span>, y = read();</div><div class="line">			<span class="keyword">int</span> t = min(x+y, n+<span class="number">1</span>);</div><div class="line">			cut(x, nxt[x]); link(x, nxt[x]=t);</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>

    </div>
    <div class="article-catetags">


  <div class="tags-icon">
  
    <a href="/tags/分块/">分块</a><a href="/tags/LCT/">LCT</a>
  </div>

</div>

  </article>
</div>  

        
          
	<div class="this-is-a-very-long-class-name" id="comments"></div>
	<script type="text/javascript">
		new Valine({
            av: AV, 
            el: '.this-is-a-very-long-class-name',
            app_id: 'h3fpaex2rIrXIA4BXkhAT9H0-gzGzoHsz',
            app_key: 'Ar7Yt5v6dLnd0v7G3reEnXkL',
            placeholder: 'ヾﾉ≧∀≦)o来啊，快活啊!',
            notify: true,
  			verify: true
        });
	</script>

        
      </div>
      <aside class="sidebar">

  <div class="hitokoto">
  <p class="sidebar-title">一言</p>
  <div class="hitokoto-text" id="yiyan-text">Loading...</div>
  <div class="hitokoto-author" id="yiyan-author"></div>
  <script type="text/javascript">$.get("https://sslapi.hitokoto.cn/?c=ac",function(data){var yy=JSON.parse(data);$('#yiyan-text').html(yy.hitokoto);$('#yiyan-author').html('《'+yy.from+'》');})</script>
</div>

  <div class="linkslist">
  <p class="sidebar-title">友情链接</p>
  <div class="sidebar-main">
    <ul>
      <li><a href="https://shenzhebei.github.io/" target="_blank">SHENZHEBEI</a></li>
      <li><a href="http://blog.csdn.net/largecub233/" target="_blank">largecub233</a></li>
      <li><a href="http://blog.csdn.net/Fop_zz/" target="_blank">Fop_zz</a></li>
      <li><a href="http://blog.csdn.net/jzq233jzq/" target="_blank">jzq233jzq</a></li>
      <li><a href="https://zhzh2001.github.io/" target="_blank">zhzh2001</a></li>
      <li><a href="http://blog.csdn.net/mdnd1234/" target="_blank">mdnd</a></li>
      <li><a href="http://www.bilibili.com/" target="_blank">bilibili(乱入)</a></li>
      <li><a href="http://blog.csdn.net/zhouyuyang233/" target="_blank">zhouyuyang233</a></li>
      <li><a href="https://littleredstar.github.io/" target="_blank">black_moon</a></li>
      <li><a href="https://problem233.github.io/" target="_blank">problem233</a></li>
      <li><a href="http://blog.csdn.net/nn020701/" target="_blank">nn020701</a></li>
    </ul>
  </div>
</div>

</aside>
    </div>
    <footer>
      <p>Powered by <a href="https://hexo.io/" target="view_window">Hexo</a> and theme by <a href="https://github.com/swwind/hacker" target="view_window">Hacker</a></p>
    </footer>
    <!-- It must be a script element -->
  </body>
</html>

