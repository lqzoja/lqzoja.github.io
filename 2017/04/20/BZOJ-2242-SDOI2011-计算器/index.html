

<!-- post | photo -->
<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">

<title>BZOJ 2242: [SDOI2011]计算器 | SW_Wind&#39;s blog</title>

<script src="/js/jquery-2.0.3.min.js"></script>
<link rel="stylesheet" type="text/css" href="/css/style.css">
<!-- Mathjax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});
</script>
<script type="text/javascript" async
  src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML">
</script>
<!-- Valine -->
<script src="https://cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src="/js/Valine.min.js"></script>
  </head>
  <body>
    <header>
      <div style="background-image: url(/img/author.jpg)" class="author_img"></div>
<div class="blog-title">
	<p class="title">SW_Wind&#39;s blog</p>
	<p class="subtitle">你指尖跃动的电光，是我此生不变的信仰</p>
</div>
<ul class="headerlinks">

  <li><a href="/">首页</a></li>

  <li><a href="/about">关于</a></li>

  <li><a href="/archives">档案</a></li>

</ul>
    </header>
    <div class="container">
      <div class="main">
        <div class="post">
  <article>
    <div class="artc-title">
      <h1>BZOJ 2242: [SDOI2011]计算器</h1>
      <p><span class="time-icon">2017-04-20</span><span class="author-icon">SW_Wind</span></p>
    </div>
    <div class="artc">
      
        <div class="toc-father">
          <strong class="toc-title">文章目录</strong>
          
            <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#题面"><span class="toc-number">1.</span> <span class="toc-text">题面</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Input"><span class="toc-number">2.</span> <span class="toc-text">Input</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Output"><span class="toc-number">3.</span> <span class="toc-text">Output</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Sample-Input-1"><span class="toc-number">4.</span> <span class="toc-text">Sample Input #1</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Sample-Output-1"><span class="toc-number">5.</span> <span class="toc-text">Sample Output #1</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Sample-Input-2"><span class="toc-number">6.</span> <span class="toc-text">Sample Input #2</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Sample-Output-2"><span class="toc-number">7.</span> <span class="toc-text">Sample Output #2</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#HINT"><span class="toc-number">8.</span> <span class="toc-text">HINT</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#题解"><span class="toc-number">9.</span> <span class="toc-text">题解</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#代码"><span class="toc-number">10.</span> <span class="toc-text">代码</span></a></li></ol>
          
        </div>
      
      <h1 id="题面"><a href="#题面" class="headerlink" title="题面"></a>题面</h1><p>你被要求设计一个计算器完成以下三项任务：</p>
<ol>
<li>给定y,z,p，计算$y^zmod\ p$的值；</li>
<li>给定y,z,p，计算满足$xy\equiv z\pmod p$的最小非负整数；</li>
<li>给定y,z,p，计算满足$y^x\equiv z\pmod p$的最小非负整数。</li>
</ol>
<h1 id="Input"><a href="#Input" class="headerlink" title="Input"></a>Input</h1><p>输入包含多组数据。<br>第一行包含两个正整数T,K分别表示数据组数和询问类型（对于一个测试点内的所有数据，询问类型相同）。<br>以下行每行包含三个正整数y,z,p，描述一个询问。</p>
<h1 id="Output"><a href="#Output" class="headerlink" title="Output"></a>Output</h1><p>对于每个询问，输出一行答案。对于询问类型2和3，如果不存在满足条件的，则输出“Orz, I cannot find x!”，注意逗号与“I”之间有一个空格。</p>
<h1 id="Sample-Input-1"><a href="#Sample-Input-1" class="headerlink" title="Sample Input #1"></a>Sample Input #1</h1><p>3 1<br>2 1 3<br>2 2 3<br>2 3 3</p>
<h1 id="Sample-Output-1"><a href="#Sample-Output-1" class="headerlink" title="Sample Output #1"></a>Sample Output #1</h1><p>2<br>1<br>2</p>
<h1 id="Sample-Input-2"><a href="#Sample-Input-2" class="headerlink" title="Sample Input #2"></a>Sample Input #2</h1><p>3 2<br>2 1 3<br>2 2 3<br>2 3 3</p>
<h1 id="Sample-Output-2"><a href="#Sample-Output-2" class="headerlink" title="Sample Output #2"></a>Sample Output #2</h1><p>2<br>1<br>0</p>
<h1 id="HINT"><a href="#HINT" class="headerlink" title="HINT"></a>HINT</h1><p>对于100%的数据，1&lt;=y,z,p&lt;=10^9，为质数，1&lt;=T&lt;=10。</p>
<h1 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h1><p>第一问就不说了<br>第二问就是exgcd<br>第三问就是BSGS<br>BSGS就是求$a^x\equiv b\pmod p$的最小非负数解用的<br>基本思路是这样的：<br>如果$p$是质数，或者说$p$与$a$互质，那么：任意取一自然数$m(m\leq p)$。可令$x=km-r$，其中$(m&gt;r\geq0)$。代入方程：$a^{km}=ba^r\pmod p$。将$r$从$0$循环到$m-1$，计算出所有$ba^r\pmod p$，然后把每一个取值所对应的$r$存在一个哈希表里。如果$p$比较大就开$map$，如果$p$比较小就直接用数组把。并且这个取值和$r$不是一一对应的，但是这并无大碍。然后计算$a^m$，并且将$k$从$1$循环到$p/m$，对于每一个$k$计算出$a^{km}$，然后在哈希表中寻找有没有对应的$r$存在。如果存在那么就找到了一个解$x=km-r$。如果用$map$做哈希表：效率$\Theta((m+n/m)logm)$。在$m=[\sqrt n]$时效率最高。<br>简单来说，步骤为：</p>
<ol>
<li>令$m=\lceil\sqrt p\rceil(向上取整)$</li>
<li>枚举$a^0,a^1,…,a^{m-1}$，将这些数插入哈希表</li>
<li>令$d=a^m$枚举$d^0,d^1,…,d^m$</li>
<li>对于枚举到的每一个$d^i$，利用EXGCD求出$d^i*x≡b\pmod p$的唯一非负整数解，去Hash表中寻找$x$是否出现过。</li>
<li>如果找到$x=a^j$，那么答案为$i*m+j$</li>
<li>如果枚举结束仍未找到$x$，则无解。</li>
</ol>
<p><a href="http://lbn187.is-programmer.com/posts/103186.html" target="_blank" rel="external">我哪里抄来的重要吗</a></p>
<h1 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h1><figure class="highlight cpp"><table><tr><td class="code"><pre><div class="line"><span class="comment">// 我tm全开long long才过</span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> ll long long</span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="function">ll <span class="title">power</span><span class="params">(ll x, ll y, ll p)</span></span>&#123;</div><div class="line">	ll ans = <span class="number">1</span>;x%=p;</div><div class="line">	<span class="keyword">while</span>(y)&#123;</div><div class="line">		<span class="keyword">if</span>(y&amp;<span class="number">1</span>) ans = ans*x%p;</div><div class="line">		x = x*x%p;</div><div class="line">		y &gt;&gt;= <span class="number">1</span>;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> ans;</div><div class="line">&#125;</div><div class="line"><span class="function">ll <span class="title">work1</span><span class="params">(ll x, ll y, ll p)</span></span>&#123;</div><div class="line">	<span class="built_in">printf</span>(<span class="string">"%lld\n"</span>, power(x, y, p));</div><div class="line">&#125;</div><div class="line"><span class="function">ll <span class="title">gcd</span><span class="params">(ll a, ll b)</span></span>&#123;<span class="keyword">return</span> b?gcd(b, a%b):a;&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">exgcd</span><span class="params">(ll a, ll b, ll &amp;x, ll &amp;y)</span></span>&#123;</div><div class="line">	<span class="keyword">if</span>(!b)&#123; x = <span class="number">1</span>, y = <span class="number">0</span>; <span class="keyword">return</span>;&#125;</div><div class="line">	exgcd(b, a%b, x, y);</div><div class="line">	ll t = x; x = y; y = t-a/b*y;</div><div class="line">&#125;</div><div class="line"><span class="function">ll <span class="title">work2</span><span class="params">(ll y, ll z, ll p)</span></span>&#123;</div><div class="line">	ll t = gcd(y, -p);</div><div class="line">	<span class="keyword">if</span>(z%t) <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">"Orz, I cannot find x!"</span>);</div><div class="line">	y /= t, z /= t, p = -p/t;</div><div class="line">	ll a, b; exgcd(y, p, a, b);</div><div class="line">	a = a*z%p;</div><div class="line">	<span class="keyword">if</span>(a &lt; <span class="number">0</span>) a += p;</div><div class="line">	<span class="built_in">printf</span>(<span class="string">"%lld\n"</span>, a);</div><div class="line">&#125;</div><div class="line"><span class="built_in">map</span>&lt;ll, ll&gt; mp;</div><div class="line"><span class="function">ll <span class="title">work3</span><span class="params">(ll y, ll z, ll p)</span></span>&#123;</div><div class="line">	mp.clear(); y %= p;</div><div class="line">	<span class="keyword">if</span>(!y&amp;&amp;!z)<span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">"1"</span>);</div><div class="line">	<span class="keyword">if</span>(!y)<span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">"Orz, I cannot find x!"</span>);</div><div class="line">	ll m = <span class="built_in">ceil</span>(<span class="built_in">sqrt</span>(p)), t = <span class="number">1</span>;</div><div class="line">	mp[<span class="number">1</span>] = m+<span class="number">1</span>;</div><div class="line">	<span class="keyword">for</span>(ll i = <span class="number">1</span>; i &lt; m; i++)&#123;</div><div class="line">		t = t*y%p;</div><div class="line">		<span class="keyword">if</span>(!mp[t])mp[t]=i;</div><div class="line">	&#125;</div><div class="line">	ll tmp = power(y, p-m<span class="number">-1</span>, p), ine = <span class="number">1</span>;</div><div class="line">	<span class="keyword">for</span>(ll k = <span class="number">0</span>; k &lt; m; k++)&#123;</div><div class="line">		ll i = mp[z*ine%p];</div><div class="line">		<span class="keyword">if</span>(i)&#123;</div><div class="line">			<span class="keyword">if</span>(i == m+<span class="number">1</span>) i=<span class="number">0</span>;</div><div class="line">			<span class="keyword">return</span> <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>, k*m+i);</div><div class="line">		&#125;</div><div class="line">		ine = ine*tmp%p;</div><div class="line">	&#125;</div><div class="line">	<span class="built_in">puts</span>(<span class="string">"Orz, I cannot find x!"</span>);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">	ll T, k, x, y, z;</div><div class="line">	<span class="built_in">scanf</span>(<span class="string">"%lld%lld"</span>, &amp;T, &amp;k);</div><div class="line">	<span class="keyword">while</span>(T--)&#123;</div><div class="line">		<span class="built_in">scanf</span>(<span class="string">"%lld%lld%lld"</span>, &amp;x, &amp;y, &amp;z);</div><div class="line">		<span class="keyword">switch</span>(k)&#123;</div><div class="line">			<span class="keyword">case</span> <span class="number">1</span>: work1(x, y, z); <span class="keyword">break</span>;</div><div class="line">			<span class="keyword">case</span> <span class="number">2</span>: work2(x, y, z); <span class="keyword">break</span>;</div><div class="line">			<span class="keyword">case</span> <span class="number">3</span>: work3(x, y, z); <span class="keyword">break</span>;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
    </div>
    <div class="article-catetags">


  <div class="tags-icon">
  
    <a href="/tags/BSGS/">BSGS</a>
  </div>

</div>

  </article>
</div>  

        
          
	<div class="comment"></div>
	<script type="text/javascript">
		new Valine({
            av: AV, 
            el: '.comment',
            app_id: 'h3fpaex2rIrXIA4BXkhAT9H0-gzGzoHsz',
            app_key: 'Ar7Yt5v6dLnd0v7G3reEnXkL',
            placeholder: 'ヾﾉ≧∀≦)o来啊，快活啊!',
            notify: true,
  			verify: true
        });
	</script>

        
      </div>
      <aside class="sidebar">

  <div class="hitokoto">
  <p class="sidebar-title">一言</p>
  <div class="hitokoto-text" id="yiyan-text">Loading...</div>
  <div class="hitokoto-author" id="yiyan-author"></div>
  <script type="text/javascript">$.get("https://sslapi.hitokoto.cn/?c=ac",function(data){var yy=JSON.parse(data);$('#yiyan-text').html(yy.hitokoto);$('#yiyan-author').html('《'+yy.from+'》');})</script>
</div>

  <div class="linkslist">
  <p class="sidebar-title">友情链接</p>
  <div class="sidebar-main">
    <ul>
      <li><a href="https://shenzhebei.github.io/" target="_blank">SHENZHEBEI</a></li>
      <li><a href="http://blog.csdn.net/largecub233/" target="_blank">largecub233</a></li>
      <li><a href="http://blog.csdn.net/Fop_zz/" target="_blank">Fop_zz</a></li>
      <li><a href="http://blog.csdn.net/jzq233jzq/" target="_blank">jzq233jzq</a></li>
      <li><a href="https://zhzh2001.github.io/" target="_blank">zhzh2001</a></li>
      <li><a href="http://blog.csdn.net/mdnd1234/" target="_blank">mdnd</a></li>
      <li><a href="http://www.bilibili.com/" target="_blank">bilibili(乱入)</a></li>
      <li><a href="http://blog.csdn.net/zhouyuyang233/" target="_blank">zhouyuyang233</a></li>
      <li><a href="https://littleredstar.github.io/" target="_blank">black_moon</a></li>
      <li><a href="https://problem233.github.io/" target="_blank">problem233</a></li>
      <li><a href="http://blog.csdn.net/nn020701/" target="_blank">nn020701</a></li>
    </ul>
  </div>
</div>

</aside>
    </div>
    <footer>
      <p>Powered by <a href="https://hexo.io/" target="_view">Hexo</a> and theme by <a href="https://github.com/swwind/hacker" target="_view">Hacker</a></p>
    </footer>
    <!-- It must be a script element -->
  </body>
</html>

